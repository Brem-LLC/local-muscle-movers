---
import { createReader } from '@keystatic/core/reader'
import keystaticConfig from "../../keystatic.config"
import Layout from '@layouts/Base.astro'
import Hero from '@components/Hero.astro'
import ShortHero from '@components/ShortHero.astro'
import Mission from '@components/Aboutpage/Mission.astro'
import Services from '@components/Services.astro'
import Story from '@components/Aboutpage/Story.astro'
import WhyLMM from '@components/Aboutpage/WhyLMM.astro'
import MovingChecklist from '@components/Resourcespage/MovingChecklist.astro'
import Policies from '@components/Resourcespage/Policies.astro'
import ReviewCTA from '@components/ReviewCTA.astro'
import NedQuote from '@components/Aboutpage/NedQuote.astro'

export async function getStaticPaths() {
	const reader = createReader(process.cwd(), keystaticConfig)
	const pages = await reader.collections.pages.all()
	return pages.map(({ slug, entry }) => {
		return {
			params: { slug },
			props: { entry }
		}
	})
}

const { entry } = Astro.props
console.log(entry)
const heroData = entry.componentBlocks.filter((bl) => bl.discriminant === 'banner')
const shortHeroBlock = entry.componentBlocks.filter((bl) => bl.discriminant === 'shortHero')
const videoAndTextArea = entry.componentBlocks.filter((bl) => bl.discriminant === 'videoText')
const selectedServicesArea = entry.componentBlocks.filter((bl) => bl.discriminant === 'serviceSelector')
const testimonialCTA = entry.componentBlocks.filter((bl) => bl.discriminant === 'testimonialCTA')
const movingChecklistBlock = entry.componentBlocks.filter((bl) => bl.discriminant === 'movingChecklist')
const headerAndTextBlocks = entry.componentBlocks.filter((bl) => bl.discriminant === 'headerText')
const policiesBlock = entry.componentBlocks.filter((bl) => bl.discriminant === 'policiesAndContracts')
---

<Layout title={`${entry.name}`}>
    {heroData[0] && <Hero heroData={heroData[0].value} />}
    {shortHeroBlock[0] && <ShortHero block={shortHeroBlock[0].value} />}
    {videoAndTextArea[0] && videoAndTextArea[0] === 'vertical' ?
	    (
            videoAndTextArea[0] || selectedServicesArea[0] ? 
            <Services videoAndTextArea={videoAndTextArea[0].value} selectedServicesArea={selectedServicesArea[0].value} /> 
            : 
            <></>
        )
    :
        (
            videoAndTextArea[0] && <Story block={videoAndTextArea[0].value} />
        )
    }
    {headerAndTextBlocks.length > 1 ?
    (
        (headerAndTextBlocks[0] ? <Mission block={headerAndTextBlocks[0].value} /> : <></>)
	    (headerAndTextBlocks[1] ? <WhyLMM block={headerAndTextBlocks[1].value} /> : <></>)
    )
    :
    (
        (headerAndTextBlocks[0] ? <Mission block={headerAndTextBlocks[0].value} /> : <></>)
    )
    }
    {movingChecklistBlock[0] && <MovingChecklist block={movingChecklistBlock[0].value} />}
	{policiesBlock[0] && <Policies block={policiesBlock[0].value} />}
    {testimonialCTA[0] && testimonialCTA[0].value.testimonialType === 'review' ?
	    (
            testimonialCTA[0] && <ReviewCTA reviewContent={testimonialCTA[0].value} />
        )
    :
	    (
            testimonialCTA[0] && <NedQuote block={testimonialCTA[0].value} />
        )
    }
</Layout>