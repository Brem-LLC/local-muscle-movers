---
import { createReader } from '@keystatic/core/reader'
import keystaticConfig from 'keystatic.config'
import Layout from '@layouts/Base.astro'
import ShortHero from '@components/ShortHero.astro'
import Story from '@components/Aboutpage/Story.astro'
import Mission from '@components/Aboutpage/Mission.astro'
import WhyLMM from '@components/Aboutpage/WhyLMM.astro'
import NedQuote from '@components/Aboutpage/NedQuote.astro'

const reader = createReader(process.cwd(), keystaticConfig);
const aboutData = await reader.collections.pages.read('about');
const shortHeroBlock = aboutData?.componentBlocks.filter(bl => bl.discriminant === 'shortHero')
const storyBlock = aboutData?.componentBlocks.filter(bl => bl.discriminant === 'videoText')
const headerAndTextBlocks = aboutData?.componentBlocks.filter(bl => bl.discriminant === 'headerText')
const quoteBlock = aboutData?.componentBlocks.filter(bl => bl.discriminant === 'testimonialCTA')
---

<Layout title="About">
	{shortHeroBlock[0] && <ShortHero block={shortHeroBlock[0].value} />}
	{storyBlock[0] && <Story block={storyBlock[0].value} />}
	{headerAndTextBlocks[0] && <Mission block={headerAndTextBlocks[0].value} />}
	{headerAndTextBlocks[1] && <WhyLMM block={headerAndTextBlocks[1].value} />}
	{quoteBlock[0] && <NedQuote block={quoteBlock[0].value} />}
</Layout>
